<!DOCTYPE html>
<html lang="en">
<head>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <title>Bloxd World – Share and Discover Mods</title>
<meta name="description" content="Bloxd World is a community-driven modding site where you can upload, vote, and explore creative mods for Bloxd. Built by NeonJet Studios.">
<meta property="og:title" content="Bloxd World – Share and Discover Mods">
<meta property="og:description" content="Upload and explore mods for Bloxd. Vote, sort, and share your creations.">
<meta property="og:image" content="https://bloxdworld.pages.dev/THE PLACE FOR.png">
<meta property="og:url" content="https://bloxdworld.pages.dev">
<meta name="twitter:card" content="summary_large_image">
<link rel="stylesheet" href="styles/earth-cube.css">
<link rel="stylesheet" href="styles/header.css">
<link rel="stylesheet" href="styles/devlogandindex.css">
<link rel="stylesheet" href="styles/other.css">
<link rel="stylesheet" href="styles/navbar.css">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
.cta-buttons {
  margin-top: 20px;
  display: flex;
  gap: 16px;
  justify-content: center;
}

.cta-button {
  padding: 12px 24px;
  background-color: #007c7e;
  color: white;
  border-radius: 8px;
  text-decoration: none;
  font-weight: bold;
  transition: background-color 0.3s ease;
}

.cta-button:hover {
  background-color: #009fa1;
}
.intro-text {
  max-width: 100%;
  margin: 20px auto 30px;
  font-size: 25px;
  text-align: center;
  color: #333;
  line-height: 1.6;
  transition: color 0.3s ease;
}

body.dark-mode .intro-text {
  color: #eee;
}
.how-it-works {
  max-width: 800px;
  margin: 60px auto;
  padding: 20px;
  background-color: #ffffff;
  border-radius: 12px;
  box-shadow: 0 0 12px rgba(0, 255, 255, 0.1);
  text-align: center;
}

.how-it-works h2 {
  font-size: 28px;
  color: #007c7e;
  margin-bottom: 20px;
}

.how-it-works ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.how-it-works li {
  font-size: 18px;
  margin: 12px 0;
  color: #333;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

body.dark-mode .how-it-works {
  background-color: #222;
  color: #eee;
  box-shadow: 0 0 12px rgba(0, 255, 255, 0.2);
}

body.dark-mode .how-it-works h2 {
  color: #00e0e2;
}

body.dark-mode .how-it-works li {
  color: #ccc;
}
/* Container for the mod title and icon */
#nameHolder {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 20px;
  padding: 12px 0;
  border-bottom: 1px solid #e0e0e0;
}

.modIcon {
  width: 72px;
  height: 72px;
  border-radius: 12px;
  object-fit: cover;
  background-color: #f0f0f0;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
}

/* Mod title */
#nameHolder h1 {
  margin: 0;
  font-size: 2em;
  font-weight: 600;
  color: #1a1a1a;
  font-family: 'Inter', 'Segoe UI', sans-serif;
}

/* Metadata line */
p span#uploadDate,
p span#uploaderName,
p span#category {
  font-weight: 500;
  color: #666;
}

p {
  font-family: 'Inter', 'Segoe UI', sans-serif;
  font-size: 0.95em;
  color: #444;
  margin: 8px 0;
}

/* Mod image */
#imageHolder img {
  width: 100%;
  border-radius: 10px;
  margin: 20px 0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
}

/* Description block */
h4 {
  font-size: 1.05em;
  line-height: 1.7;
  color: #2c2c2c;
  background: #f9f9f9;
  padding: 18px;
  border-radius: 10px;
  white-space: pre-wrap;
  font-family: 'Inter', 'Segoe UI', sans-serif;
  border: 1px solid #e5e5e5;
}

/* Code snippet */
#codeSnippet {
  background-color: #282c34;
  color: #e6e6e6;
  border: none;
  padding: 14px;
  border-radius: 8px;
  font-family: 'Fira Code', 'Courier New', monospace;
  font-size: 0.95em;
  overflow-x: auto;
  white-space: pre-wrap;
  margin-top: 16px;
}

/* Copy button */
#copyButton {
  background: #00b894;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  margin-left: 8px;
  transition: background 0.2s ease;
}

#copyButton:hover {
  background: #009e7a;
}
.dark-mode #nameHolder h1 {
  color: #f2f2f2;
}

.dark-mode .modIcon {
  background-color: #2a2a2a;
  box-shadow: 0 1px 4px rgba(255, 255, 255, 0.05);
}

.dark-mode p span#uploadDate,
.dark-mode p span#uploaderName,
.dark-mode p span#category {
  color: #aaa;
}

.dark-mode p {
  color: #ccc;
}

.dark-mode #imageHolder img {
  box-shadow: 0 2px 10px rgba(255, 255, 255, 0.05);
}

.dark-mode h4 {
  background: #1e1e1e;
  color: #ddd;
  border: 1px solid #333;
}

.dark-mode #codeSnippet {
  background-color: #111;
  color: #eee;
}

.dark-mode #copyButton {
  background: #007f6e;
}

.dark-mode #copyButton:hover {
  background: #005f52;
}
/* Container for all 5 day bars */
.analytics-bars-container {
    display: flex; /* Arrange bars horizontally */
    gap: 15px; /* Space between bars */
    align-items: flex-end; /* Align bars to the bottom */
    height: 200px; /* Give space for bars to grow */
    padding: 10px;
    background-color: #f0f0f0;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
}

/* Wrapper for each day's label, bar, and value */
.day-bar-wrapper {
    display: flex;
    flex-direction: column; /* Stack label, bar, value vertically */
    align-items: center;
    justify-content: flex-end; /* Push content to the bottom */
    height: 100%; /* Take full height of .analytics-bars-container */
    min-width: 40px; /* Ensure a minimum width for each bar column */
}

.day-label {
    font-size: 0.8em;
    color: #555;
    margin-bottom: 5px;
    flex-shrink: 0; /* Prevent label from shrinking */
}

/* Styles for the actual bar (outer container) */
.progress-bar-container {
    width: 25px; /* Width of the individual bar */
    height: 100%; /* Fill the height of its parent (.day-bar-wrapper) */
    background-color: #ddd;
    border-radius: 5px;
    overflow: hidden; /* Keep fill within rounded corners */
    position: relative;
    flex-grow: 1; /* Allow container to grow if needed */
    margin-bottom: 5px; /* Space between bar and value */
}

/* Styles for the bar's fill (inner element) */
.progress-bar-fill {
    width: 100%;
    height: 0%; /* Initial height, will be updated by JS */
    background-color: #6a0dad; /* A nice purple for analytics bars */
    position: absolute;
    bottom: 0; /* IMPORTANT: Makes it fill from the bottom up */
    left: 0;
    transition: height 0.5s ease-in-out; /* Smooth transition */
    border-radius: 5px;
}

.day-value {
    font-size: 0.9em;
    font-weight: bold;
    color: #333;
    flex-shrink: 0; /* Prevent value from shrinking */
}
.dark-mode .analytics-bars-container {
    background-color: #222;
    border: 1px solid #444;
}
.dark-mode .day-label {
    color: #bbb;
}
.dark-mode .progress-bar-container {
    background-color: #333;
}
.dark-mode .progress-bar-fill {
    background-color: #9b59b6; /* A lighter purple for dark mode */
}
.dark-mode .day-value {
    color: #eee;
}
  </style>
</head>
<body>

  <!-- 🧠 Header -->
  <div class="header">
    <div class="header-left">
      <div style="display: flex; align-items: center; height: 100%;">
        <div class="cube-container">
          <div class="cube">
            <div class="face front"></div>
            <div class="face back"></div>
            <div class="face right"></div>
            <div class="face left"></div>
            <div class="face top"></div>
            <div class="face bottom"></div>
          </div>
        </div>
      </div>
      <div class="logo-text"> Bloxd <br>World</div>
    </div>

       <div class="header-right">
  <ul class="navbar">
    <li class="nav-item">
      <a href="index.html">
        <i class="fas fa-home"></i>
        <span class="nav-label">Home</span>
      </a>
    </li>
    <li class="nav-item">
      <a href="mods.html">
        <i class="fas fa-cubes"></i>
        <span class="nav-label">Mods</span>
      </a>
    </li>
    <li class="nav-item">
      <a href="upload.html">
        <i class="fas fa-upload"></i>
        <span class="nav-label">Upload</span>
      </a>
    </li>
    <li class="nav-item">
      <a href="about.html">
        <i class="fas fa-info-circle"></i>
        <span class="nav-label">About</span>
      </a>
    </li>
    <li class="nav-item">
      <a href="leaderboard.html">
        <i class="fas fa-trophy"></i>
        <span class="nav-label">Leaderboard</span>
      </a>
    </li>
    <li class="nav-item">
      <a href="#" id="themeToggle">
        <i class="fas fa-moon"></i>
        <span class="nav-label">Theme</span>
      </a>
    </li>
<li class="nav-item" id="authArea">
  </ul>
    </div>
  </div>
<div id="nameHolder" style="display: flex; align-items: center; gap: 12px;">
  <img src="https://bloxdworld.pages.dev/assets/pixil-frame-0%20%2814%29.png" alt="Mod Icon" class="modIcon" style="width: 64px; height: 64px;">
  <h1 style="margin: 0;">Lorem ipsum dolor sit amet</h1>
</div>
<p style="text-align: left;">Uploaded on: <span id="uploadDate">October 1, 2023</span> | Made by: <span id="uploaderName">John Doe</span> | Category: <span id="category">Other</span></p>
<div id="imageHolder"></div>
<h4 style="text-align: left; font-weight:normal;">Consectetur adipiscing elit</h4>
<p style="text-align: left; background-color:#ccc;color:black;border: solid 1px rgb(94, 87, 87);" id="codeSnippet">console.log('Hello, world!');</p>
<p>Copy code to clipboard: <button id="copyButton">Copy</button></p>
<div id="analytics-data">
        <h3>Mod Analytics (Last 5 Days)</h3>
        <div class="analytics-bars-container">
            <div class="day-bar-wrapper">
                <span class="day-label">Day 1</span>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="day1Fill"></div>
                </div>
                <span class="day-value" id="day1Value">N/A</span>
            </div>

            <div class="day-bar-wrapper">
                <span class="day-label">Day 2</span>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="day2Fill"></div>
                </div>
                <span class="day-value" id="day2Value">N/A</span>
            </div>

            <div class="day-bar-wrapper">
                <span class="day-label">Day 3</span>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="day3Fill"></div>
                </div>
                <span class="day-value" id="day3Value">N/A</span>
            </div>

            <div class="day-bar-wrapper">
                <span class="day-label">Day 4</span>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="day4Fill"></div>
                </div>
                <span class="day-value" id="day4Value">N/A</span>
            </div>

            <div class="day-bar-wrapper">
                <span class="day-label">Day 5</span>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="day5Fill"></div>
                </div>
                <span class="day-value" id="day5Value">N/A</span>
            </div>
        </div>
    </div>
  <script>
const themeToggle = document.getElementById("themeToggle");
const urlParams = new URLSearchParams(window.location.search);
const sharedAddonId = urlParams.get("addonId");

if (sharedAddonId) {
  fetch("https://opensheet.vercel.app/1DR9qcrbVIV1uirY5MHHRPSQhuf5n8Cd2zuBb77uEZWg/Form%20Responses%201")
    .then(response => response.json())
    .then(data => {
      const mod = data.find(mod => mod["Addon ID"] === sharedAddonId);

      if (!mod) {
        console.error("Addon not found.");
        return;
      }

      // 🖼️ Add mod image if available
      if (mod["Image (upload image to imgur, put the link here.)"]) {
        const imageHolder = document.getElementById("imageHolder");
        const img = document.createElement("img");
        img.src = mod["Image (upload image to imgur, put the link here.)"];
        img.alt = "Mod Image";
        imageHolder.appendChild(img);
      }
        const modIcon = document.querySelector(".modIcon");
        modIcon.alt = "Mod Icon";
      // 🖼️ Add mod icon if available
      if (mod["Mod Icon (samething as Image uploading, but this will be displayed.)"]) {
        modIcon.src = mod["Mod Icon (samething as Image uploading, but this will be displayed.)"];
      }
      // 📝 Fill in mod details
      document.getElementById("uploadDate").textContent = mod["Timestamp"];
      document.getElementById("uploaderName").textContent = mod["Author Name (leave blank for your username to be displayed anonymous)"];
      document.getElementById("category").textContent = mod["Category (what type of mod is this?)"];
      document.getElementById("codeSnippet").textContent = mod["Addon Code"];
      document.title = `${mod["Addon Name"]} - Bloxd World`;
      document.querySelector("h1").textContent = mod["Addon Name"];
function formatModDescription(rawText) {
  // Step 1: Escape HTML first
  const escapeHTML = (str) =>
    str.replace(/&/g, "&amp;")
       .replace(/</g, "&lt;")
       .replace(/>/g, "&gt;");

  let formatted = escapeHTML(rawText);

  // Step 4: Inline formatting
  formatted = formatted
    .replace(/\*(.*?)\*/g, "<strong>$1</strong>")     // *bold*
    .replace(/\/(.*?)\//g, "<em>$1</em>")             // /italic/
    .replace(/_(.*?)_/g, "<u>$1</u>")                 // _underline_
    .replace(/`([^`]+)`/g, "<code>$1</code>");        // `inline code`

  // Step 5: Line breaks
  formatted = formatted.replace(/\n/g, "<br>");

  return formatted;
}
// --- Function to update day-by-day analytics with vertical bars (with Debugging) ---
function updateDayAnalytics(mod) {
    console.log("DEBUG: updateDayAnalytics function called.");
    console.log("DEBUG: Input 'mod' object:", mod);

    // Select all the fill and value elements for initial clearing/setup
    const fillElements = [];
    const valueElements = [];
    for (let i = 1; i <= 5; i++) {
        fillElements.push(document.getElementById(`day${i}Fill`));
        valueElements.push(document.getElementById(`day${i}Value`));
    }
    console.log("DEBUG: HTML fill elements found:", fillElements);
    console.log("DEBUG: HTML value elements found:", valueElements);


    // Basic input validation and clearing if data is invalid/missing
    if (!mod || typeof mod !== 'object' || !mod["Mod Analytics"]) {
        console.warn("DEBUG: Invalid mod object or missing 'Mod Analytics' data for analytics display. Clearing bars.");
        fillElements.forEach(el => { if (el) el.style.height = '0%'; });
        valueElements.forEach(el => { if (el) el.textContent = "N/A"; });
        return;
    }

    let analyticsData;
    try {
        analyticsData = JSON.parse(mod["Mod Analytics"]);
        console.log("DEBUG: Parsed 'Mod Analytics' data:", analyticsData);
    } catch (e) {
        console.error("DEBUG: Failed to parse 'Mod Analytics' JSON for analytics display:", e);
        fillElements.forEach(el => { if (el) el.style.height = '0%'; });
        valueElements.forEach(el => { if (el) el.textContent = "Error"; });
        return;
    }

    // Extract, filter, and sort day numbers
    const dayNumbers = Object.keys(analyticsData)
        .map(key => {
            const match = key.match(/^Day (\d+)$/);
            return match ? parseInt(match[1], 10) : NaN;
        })
        .filter(num => !isNaN(num))
        .sort((a, b) => a - b);
    console.log("DEBUG: Extracted and sorted day numbers:", dayNumbers);

    // Get the values for the last 5 relevant days
    const lastFiveDayNumbers = dayNumbers.slice(-5);
    console.log("DEBUG: Last five day numbers selected:", lastFiveDayNumbers);

    const valuesForDisplay = lastFiveDayNumbers.map(dayNum => analyticsData[`Day ${dayNum}`]);
    console.log("DEBUG: Raw values for display (from analyticsData):", valuesForDisplay);

    // Calculate the maximum value among the last 5 days for scaling bars
    const numericValues = valuesForDisplay.filter(val => typeof val === 'number' && !isNaN(val));
    const maxValue = numericValues.length > 0 ? Math.max(...numericValues) : 0;
    console.log("DEBUG: Numeric values used for maxValue calculation:", numericValues);
    console.log("DEBUG: Calculated maxValue for scaling:", maxValue);

    // Pad with "N/A" if there are fewer than 5 days, ensuring correct order for display
    const paddedValues = Array(5).fill("N/A");
    for (let i = 0; i < valuesForDisplay.length; i++) {
        paddedValues[5 - valuesForDisplay.length + i] = valuesForDisplay[i];
    }
    console.log("DEBUG: Padded values for final display (with N/A):", paddedValues);

    // Update the HTML elements (both bar height and text value)
    for (let i = 0; i < 5; i++) {
        const fillEl = fillElements[i];
        const valueEl = valueElements[i];

        if (fillEl && valueEl) {
            const currentDayValue = paddedValues[i];
            let percentage = 0;

            if (typeof currentDayValue === 'number' && !isNaN(currentDayValue) && maxValue > 0) {
                percentage = (currentDayValue / maxValue) * 100;
            } else if (maxValue === 0 && currentDayValue === 0) {
                percentage = 0; // Handle case where all values are zero
            } else {
                percentage = 0; // If N/A or Error, default to 0% height
            }
            console.log(`DEBUG: Day ${i + 1} - Value: ${currentDayValue}, Percentage: ${percentage}%`);

            fillEl.style.height = `${percentage}%`;
            valueEl.textContent = currentDayValue === "N/A" ? "N/A" : currentDayValue;
        } else {
            console.warn(`DEBUG: Analytics elements (fill or value) for day ${i + 1} not found. Check HTML IDs.`);
        }
    }
    console.log("DEBUG: updateDayAnalytics function finished.");
}

// --- Main function to load addon details ---
function loadAddonDetails(sharedAddonId) {
    // Initial loading state or error message if no ID
    const mainContentArea = document.querySelector('main');
    if (!sharedAddonId) {
        console.error("No Addon ID provided to load details.");
        if (mainContentArea) {
            mainContentArea.innerHTML = '<p>No mod selected to display. Please provide an ID in the URL (e.g., ?id=your_mod_id).</p>';
        }
        return;
    }

            // ⭐ INTEGRATION POINT: Call updateDayAnalytics here!
            updateDayAnalytics(mod);

// Usage
const rawDescription = mod["About Addon / Description"];
document.querySelector("h4").innerHTML = formatModDescription(rawDescription);

      document.getElementById("copyButton").addEventListener("click", () => {
        navigator.clipboard.writeText(mod["Addon Code"]).then(() => {
          alert("Code copied to clipboard!");
        }).catch(err => {
          console.error("Failed to copy code: ", err);
        });
      });
    }})
    .catch(error => console.error("Error fetching addon:", error));
}
// Apply saved theme on load
if (localStorage.getItem("theme") === "dark") {
  document.body.classList.add("dark-mode");
}

// Toggle and save preference
themeToggle.addEventListener("click", (e) => {
  e.preventDefault();
  document.body.classList.toggle("dark-mode");

  // Save preference
  if (document.body.classList.contains("dark-mode")) {
    localStorage.setItem("theme", "dark");
  } else {
    localStorage.setItem("theme", "light");
  }
});

    const targets = document.querySelectorAll('.welcome-text, .welcome-para');

    targets.forEach(el => {
      el.addEventListener('mousemove', e => {
        const rect = el.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        el.style.setProperty('--mouse-x', `${x}px`);
        el.style.setProperty('--mouse-y', `${y}px`);
      });

      el.addEventListener('mouseleave', () => {
        el.style.setProperty('--mouse-x', `50%`);
        el.style.setProperty('--mouse-y', `50%`);
      });
    });
if (/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
  document.body.classList.add("mobile");
}
  </script>
<footer class="site-footer">
  <p>© NeonJet Studios. <strong>Bloxd World</strong> is made by NeonJet Studios and is not affiliated with Bloxd.io.</p>
  <nav class="footer-links">
    <a href="/about">About</a>
    <a href="/leaderboard">Leaderboard</a>
    <a href="/about">About</a>
    <a href="/upload">Submit a Mod</a>
    <a href="https://discord.gg/yourserver" target="_blank">Join Discord (SOON)</a>
  </nav>
</footer>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/googlelogin.js"></script>
</body>
</html>
